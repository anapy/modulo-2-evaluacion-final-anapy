"use strict";const searchButton=document.querySelector(".js-search"),serieInput=document.querySelector(".js-serie"),resultList=document.querySelector(".js-list-results"),favouriteList=document.querySelector(".js-favourite-list"),resetBtn=document.querySelector(".js-reset-button"),header=document.querySelector(".header"),defaultBackground=document.querySelector(".js-show-start");let crossBtn=document.querySelectorAll(".js-cross-button"),savedFavourites=JSON.parse(localStorage.getItem("localFavorites")),serie="",results=[],apiData=[],resultItems=[],favourites=[],favouriteItems=[];const buttonFavourites=document.querySelector(".js-show-favourites");function clickHandler(e){e.preventDefault(),defaultBackground.classList.add("hidden"),cleanHTML(resultItems,resultList),serie=serieInput.value,getApiData()}function getApiData(){fetch("http://api.tvmaze.com/search/shows?q="+serie).then(e=>e.json()).then(e=>{apiData=e,dataFilter(),printResults()})}function dataFilter(){results=[];for(let e=0;e<apiData.length;e++){let t={};t.id=apiData[e].show.id,t.name=apiData[e].show.name,checkImg(apiData,e,t),checkDays(apiData,e,t),t.listId="results",results.push(t)}}function checkDays(e,t,s){null===e[t].show.image?s.days="":s.days=e[t].show.schedule.days}function printResults(){0===results.length?inputError():(generateHTML(results,resultList),resultItems=document.querySelectorAll(".js-serie-container"),createEventListener(resultItems,handlerClickfavourite))}function inputError(){const e=document.createElement("h2");e.classList.add("js-error","error");const t=document.createTextNode("Ops, we don't find any serie with that name. Try again!");e.appendChild(t),resultList.appendChild(e),resultItems=document.querySelectorAll(".js-error")}function cleanHTML(e,t){for(const s of e)t.removeChild(s);const s=document.querySelector(".js-error");null!==s&&t.removeChild(s)}function checkImg(e,t,s){null===e[t].show.image?s.image="https://via.placeholder.com/210x295/ffffff/666666/?text=TV":s.image=e[t].show.image.medium}function createEventListener(e,t){for(const s of e)s.addEventListener("click",t)}function handlerClickfavourite(e){let t=e.currentTarget.id;cleanHTML(favouriteItems,favouriteList),checkRepeatFavourites(t),highlightFavourites(t),generateHTML(favourites,favouriteList),favouriteItems=document.querySelectorAll(".js-serie-container-small"),localStorage.setItem("localFavorites",JSON.stringify(favourites)),crossBtn=document.querySelectorAll(".js-cross-button"),savedFavourites=JSON.parse(localStorage.getItem("localFavorites")),createEventListener(crossBtn,deleteOne)}function checkRepeatFavourites(e){const t=favourites.findIndex(t=>t.id===parseInt(e));if(-1===t){const t=results.find(t=>t.id===parseInt(e));t.listId="favourite",favourites.push(t)}else favourites.splice(t,1)}function generateHTML(e,t){for(let s=0;s<e.length;s++){const r=document.createElement("li");if("results"===e[s].listId?(r.classList.add("serie-container","js-serie-container"),r.setAttribute("id",e[s].id)):(r.classList.add("serie-container-small","js-serie-container-small"),r.setAttribute("id","fav"+e[s].id)),"favourite"===e[s].listId){const t=document.createElement("button");t.classList.add("cross-button","js-cross-button"),t.setAttribute("id",e[s].id);const a=document.createElement("i");a.classList.add("fas"),a.classList.add("fa-times"),t.appendChild(a),r.appendChild(t)}const a="results"===e[s].listId?document.createElement("h2"):document.createElement("h3");a.classList.add("serie-title");const o=document.createTextNode(e[s].name);a.appendChild(o),r.appendChild(a);const i=document.createElement("IMG");if(i.setAttribute("src",e[s].image),i.setAttribute("alt",e[s].name),"favourite"===e[s].listId&&i.setAttribute("height","100px"),"results"===e[s].listId){const t=document.createElement("p");t.classList.add("days");let a=document.createTextNode("The serie is no more on TV");0!==e[s].days.length&&(a=document.createTextNode(e[s].days)),t.appendChild(a),r.appendChild(t)}if(null!==favourites&&"results"===e[s].listId){-1!==favourites.findIndex(t=>t.id===e[s].id)&&r.classList.add("js-favourite")}r.appendChild(i),t.appendChild(r)}}function highlightFavourites(e){const t=document.getElementById(""+e);null!==t&&t.classList.toggle("js-favourite")}function recoverData(){null!==savedFavourites&&0!==savedFavourites.length&&(favourites=savedFavourites,generateHTML(favourites,favouriteList),crossBtn=document.querySelectorAll(".js-cross-button"),createEventListener(crossBtn,deleteOne),favouriteItems=document.querySelectorAll(".js-serie-container-small"),resultItems=document.querySelectorAll(".js-serie-container"),localStorage.setItem("localFavorites",JSON.stringify(favourites)))}function resetFav(){crossBtn=document.querySelectorAll(".js-cross-button"),cleanHTML(favouriteItems,favouriteList);for(let e of resultItems)e.classList.remove("js-favourite");favouriteItems=[],favourites=[],localStorage.clear(),savedFavourites=favourites}function deleteOne(e){handlerClickfavourite(e)}document.addEventListener("DOMContentLoaded",recoverData),searchButton.addEventListener("click",clickHandler),resetBtn.addEventListener("click",resetFav);const showHeader=()=>{header.classList.remove("hidden"),header.classList.add("animate__animated","animate__zoomIn")};function showFav(){console.log(favourites)}setTimeout(showHeader,2500),buttonFavourites.addEventListener("click",showFav);